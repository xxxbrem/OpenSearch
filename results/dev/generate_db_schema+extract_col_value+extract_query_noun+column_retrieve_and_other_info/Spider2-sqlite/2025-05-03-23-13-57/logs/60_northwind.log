############################## Human at step extract_col_value ##############################

/* Some extract examples are provided based on similar problems: */
/* Answer the following: Please give the name of the course in which most numbers of the students got an A. Also, list the full name of the students who got an A in this course. most number of students got an A refers MAX(COUNT(student_id WHERE grade = 'A')); full name = f_name, l_name; got an A refers to grade = 'A'; */
#reason: The question requires display in order: "name of the course", "full name"."A" is filtering condition.
#columns: course.name, student.f_name, student.l_name, registration.grade, registration.student_id
#values: "A"

/* Answer the following:How much more votes for episode 1 than for episode 5? more votes refers to SUBTRACT(SUM(votes when episode = 1), SUM(votes when episode = 5)) */
#reason: The question requires display in order: "How much more vote". The definition of "more vote" is SUBTRACT(SUM(votes when episode = 1), SUM(votes when episode = 5)). 1, 5 are filtering conditions.
#columns: Episode.episode, Vote.votes
#values: "1", "5"

/* Answer the following: What is the average score of the movie "The Fall of Berlin" in 2019? Average score refers to Avg(rating_score); */
#reason: The question requires display in order: "average score". Average score is Avg(rating_score), "The Fall of Berlin",2019 are filtering conditions.
#columns: ratings.rating_score, ratings.rating_id, ratings.rating_timestamp_utc, movies.movie_title
#values: "The Fall of Berlin", "2019"

/* Answer the following: How many distinct orders were there in 2003 when the quantity ordered was less than 30? "year(orderDate) = '2003'; quantityOrdered < 30;" */
#reason:  The question requires display in order: "How many distinct orders"." in 2003", "less than 30" are filtering conditions.
#columns: orderdetails.orderNumber, orderdetails.quantityOrdered, orders.orderDate
#values: "30", "2003"

/* Answer the following: How many movies starring Shahrukh Khan have an IMDb rating higher than 8? */
SELECT COUNT(DISTINCT M.id)
FROM movie AS M
JOIN cast AS C     ON M.id = C.movie_id
JOIN actor AS A    ON C.actor_id = A.id
WHERE A.name = 'Shahrukh Khan'
  AND M.imdb_rating > 8;

/* Answer the following: List the titles of movies released in 2010 that feature both Shahrukh Khan and Kajol. */
SELECT DISTINCT M.title
FROM movie  AS M
JOIN cast   AS C1 ON M.id = C1.movie_id
JOIN actor  AS A1 ON C1.actor_id = A1.id
JOIN cast   AS C2 ON M.id = C2.movie_id
JOIN actor  AS A2 ON C2.actor_id = A2.id
WHERE A1.name = 'Shahrukh Khan'
  AND A2.name = 'Kajol'
  AND M.year = 2010;

/* Answer the following: Which director has worked with Shahrukh Khan on the greatest number of films? */
SELECT D.name
FROM director        AS D
JOIN movie_director  AS MD ON D.id = MD.director_id
JOIN movie           AS M  ON M.id = MD.movie_id
JOIN cast            AS C  ON M.id = C.movie_id
JOIN actor           AS A  ON C.actor_id = A.id
WHERE A.name = 'Shahrukh Khan'
GROUP BY D.id
ORDER BY COUNT(DISTINCT M.id) DESC
LIMIT 1;

/* Answer the following: What is the average box-office gross of Shahrukh Khan movies released between 2000 and 2009? */
SELECT AVG(M.box_office)
FROM movie AS M
JOIN cast  AS C ON M.id = C.movie_id
JOIN actor AS A ON C.actor_id = A.id
WHERE A.name = 'Shahrukh Khan'
  AND M.year BETWEEN 2000 AND 2009;

/* Answer the following: Which actor (excluding Shahrukh Khan) has appeared most frequently alongside him? */
SELECT A2.name
FROM cast  AS C1
JOIN actor AS A1 ON C1.actor_id = A1.id
JOIN cast  AS C2 ON C1.movie_id = C2.movie_id
JOIN actor AS A2 ON C2.actor_id = A2.id
WHERE A1.name = 'Shahrukh Khan'
  AND A2.name <> 'Shahrukh Khan'
GROUP BY A2.id
ORDER BY COUNT(DISTINCT C1.movie_id) DESC
LIMIT 1;



/* Database schema */
Database Management System: SQLite
#Database name: northwind
## Table categories:
categoryid: The type is INTEGER, Which does not inlude Null and is Unique. Values format like: [1, 7, 6]
categoryname: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Meat/Poultry', 'Grains/Cereals', 'Beverages']
description: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Sweet and savory sauces, relishes, spreads, and seasonings', 'Soft drinks, coffees, teas, beers, and ales', 'Seaweed and fish']
picture: The type is BLOB, Which does not inlude Null and is Non-Unique. Value of this column must in: ['\\x']

## Table customers:
customerid: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['FRANS', 'AROUT', 'VICTE']
companyname: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Old World Delicatessen', 'Que Delícia', 'Ricardo Adocicados']
contactname: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Victoria Ashworth', 'Ann Devon', 'Jose Pavarotti']
contacttitle: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['Assistant Sales Representative', 'Assistant Sales Agent', 'Sales Representative']
address: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['12 Orchestra Terrace', 'Hauptstr. 29', 'Mataderos  2312']
city: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['Cork', 'Reims', 'Seattle']
region: The type is TEXT, Which inlude Null and is Non-Unique. Values format like: ['BC', 'MT', 'Táchira']
postalcode: The type is TEXT, Which inlude Null and is Non-Unique. Values format like: [14776, '05454-876', '01-012']
country: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['Mexico', 'Norway', 'Switzerland']
phone: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['0221-0644327', '31 12 34 56', '0621-08460']
fax: The type is TEXT, Which inlude Null and is Non-Unique. Values format like: ['(5) 545-3745', '(171) 555-2530', '20.16.10.17']

## Table employees:
employeeid: The type is INTEGER, Which does not inlude Null and is Unique. Values format like: [9, 2, 7]
lastname: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Suyama', 'Leverling', 'Davolio']
firstname: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Michael', 'Margaret', 'Laura']
title: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['Inside Sales Coordinator', 'Sales Manager', 'Sales Representative']
titleofcourtesy: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['Dr.', 'Mr.', 'Mrs.']
birthdate: The type is DATE, Which does not inlude Null and is Unique. Values format like: ['1955-03-04', '1952-02-19', '1948-12-08']
hiredate: The type is DATE, Which does not inlude Null and is Non-Unique. Values format like: ['1994-03-05', '1994-11-15', '1993-05-03']
address: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Coventry House\\nMiner Rd.', '507 - 20th Ave. E.\\nApt. 2A', 'Edgeham Hollow\\nWinchester Way']
city: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['Redmond', 'Tacoma', 'London']
region: The type is TEXT, Which inlude Null and is Non-Unique. Value of this column must in: ['WA']
postalcode: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['SW1 8JR', 'EC2 7JR', 98033]
country: The type is TEXT, Which does not inlude Null and is Non-Unique. Value of this column must in: ['USA', 'UK']
homephone: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['(206) 555-3412', '(71) 555-5598', '(206) 555-9857']
extension: The type is TEXT, Which does not inlude Null and is Unique. Values format like: [3453, 452, 3457]
photo: The type is BLOB, Which does not inlude Null and is Non-Unique. Value of this column must in: ['\\x']
notes: The type is TEXT, Which does not inlude Null and is Unique. Values format: <Long text>
reportsto: The type is INTEGER, Which inlude Null and is Non-Unique. Value of this column must in: [2, 5]
photopath: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['http://accweb/emmployees/buchanan.bmp', 'http://accweb/emmployees/fuller.bmp', 'http://accweb/emmployees/peacock.bmp']

## Table employeeterritories:
employeeid: The type is INTEGER, Which does not inlude Null and is Non-Unique. Values format like: [2, 5, 9]
territoryid: The type is TEXT, Which does not inlude Null and is Unique. Values format like: [33607, 55113, 6897]

## Table order_details:
orderid: The type is INTEGER, Which does not inlude Null and is Non-Unique. Values format like: [10290, 10393, 10578]
productid: The type is INTEGER, Which does not inlude Null and is Non-Unique. Values format like: [77, 21, 7]
unitprice: The type is REAL, Which does not inlude Null and is Non-Unique. Values format like: [16, 7, 34]
quantity: The type is INTEGER, Which does not inlude Null and is Non-Unique. Values format like: [28, 13, 12]
discount: The type is REAL, Which does not inlude Null and is Non-Unique. Values format like: [0, 0, 0]

## Table orders:
orderid: The type is INTEGER, Which does not inlude Null and is Unique. Values format like: [11018, 10719, 10387]
customerid: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['CACTU', 'PRINI', 'BLONP']
employeeid: The type is INTEGER, Which does not inlude Null and is Non-Unique. Values format like: [5, 1, 6]
orderdate: The type is DATE, Which does not inlude Null and is Non-Unique. Values format like: ['1996-08-14', '1997-03-28', '1996-12-09']
requireddate: The type is DATE, Which does not inlude Null and is Non-Unique. Values format like: ['1998-01-23', '1997-02-04', '1997-01-17']
shippeddate: The type is DATE, Which inlude Null and is Non-Unique. Values format like: ['1997-05-19', '1997-12-24', '1998-03-17']
shipvia: The type is INTEGER, Which does not inlude Null and is Non-Unique. Values format like: [3, 2, 1]
freight: The type is REAL, Which does not inlude Null and is Non-Unique. Values format like: [184, 52, 229]
shipname: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['Wilman Kala', "B's Beverages", 'Tortuga Restaurante']
shipaddress: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['Garden House Crowther Way', 'Estrada da saúde n. 58', '87 Polk St. Suite 5']
shipcity: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['Århus', 'Lisboa', 'Stuttgart']
shipregion: The type is TEXT, Which inlude Null and is Non-Unique. Values format like: ['ID', 'CA', 'Nueva Esparta']
shippostalcode: The type is TEXT, Which inlude Null and is Non-Unique. Values format like: ['01-012', 'B-1180', 5023]
shipcountry: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['Germany', 'Austria', 'Italy']

## Table products:
productid: The type is INTEGER, Which does not inlude Null and is Unique. Values format like: [32, 55, 18]
productname: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Queso Cabrales', 'Côte de Blaye', 'Escargots de Bourgogne']
supplierid: The type is INTEGER, Which does not inlude Null and is Non-Unique. Values format like: [26, 24, 2]
categoryid: The type is INTEGER, Which does not inlude Null and is Non-Unique. Values format like: [2, 5, 8]
quantityperunit: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['36 boxes', '40 - 100 g pkgs.', '12 - 12 oz jars']
unitprice: The type is REAL, Which does not inlude Null and is Non-Unique. Values format like: [19, 2, 26]
unitsinstock: The type is INTEGER, Which does not inlude Null and is Non-Unique. Values format like: [69, 0, 49]
unitsonorder: The type is INTEGER, Which does not inlude Null and is Non-Unique. Values format like: [10, 60, 100]
reorderlevel: The type is INTEGER, Which does not inlude Null and is Non-Unique. Values format like: [5, 25, 15]
discontinued: The type is INTEGER, Which does not inlude Null and is Non-Unique. Value of this column must in: [1, 0]

## Table region:
regionid: The type is INTEGER, Which does not inlude Null and is Unique. Values format like: [4, 2, 3]
regiondescription: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Western', 'Eastern', 'Southern']

## Table shippers:
shipperid: The type is INTEGER, Which does not inlude Null and is Unique. Values format like: [3, 2, 6]
companyname: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Speedy Express', 'Alliance Shippers', 'United Package']
phone: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['1-800-225-5345', '(503) 555-9931', '(503) 555-3199']

## Table suppliers:
supplierid: The type is INTEGER, Which does not inlude Null and is Unique. Values format like: [22, 3, 29]
companyname: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Pavlova, Ltd.', 'New England Seafood Cannery', "Cooperativa de Quesos 'Las Cabras'"]
contactname: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Petra Winkler', 'Chantal Goulet', 'Giovanni Giudici']
contacttitle: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['Marketing Representative', 'Sales Representative', 'Regional Account Rep.']
address: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Order Processing Dept. 2100 Paul Revere Blvd.', 'Frahmredder 112a', 'Hatlevegen 5']
city: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Zaandam', 'Oviedo', 'Ste-Hyacinthe']
region: The type is TEXT, Which inlude Null and is Non-Unique. Values format like: ['NSW', 'OR', 'Québec']
postalcode: The type is TEXT, Which does not inlude Null and is Unique. Values format like: [60439, 100, 'S-123 45']
country: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['Norway', 'Canada', 'UK']
phone: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['08-123 45 67', '(514) 555-2955', '(03) 444-2343']
fax: The type is TEXT, Which inlude Null and is Non-Unique. Values format like: ['(04721) 8714', '(514) 555-2921', '(12345) 1210']
homepage: The type is TEXT, Which inlude Null and is Non-Unique. Values format like: ["Mayumi's (on the World Wide Web)#http://www.microsoft.com/accessdev/sampleapps/mayumi.htm#", "G'day Mate (on the World Wide Web)#http://www.microsoft.com/accessdev/sampleapps/gdaymate.htm#", 'Plutzer (on the World Wide Web)#http://www.microsoft.com/accessdev/sampleapps/plutzer.htm#']

## Table territories:
territoryid: The type is TEXT, Which does not inlude Null and is Unique. Values format like: [3801, 27403, 2116]
territorydescription: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['Racine', 'Morristown', 'Neward']
regionid: The type is INTEGER, Which does not inlude Null and is Non-Unique. Values format like: [1, 4, 3]

## Table usstates:
stateid: The type is INTEGER, Which does not inlude Null and is Unique. Values format like: [9, 30, 36]
statename: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['Washington', 'New Jersey', 'Rhode Island']
stateabbr: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['MO', 'TX', 'TN']
stateregion: The type is TEXT, Which does not inlude Null and is Non-Unique. Values format like: ['midwest', 'north', 'west']

## Table customergroupthreshold:
groupname: The type is TEXT, Which does not inlude Null and is Unique. Values format like: ['High', 'Medium', 'Low']
rangebottom: The type is DECIMAL, Which does not inlude Null and is Unique. Values format like: [5000, 0, 1000]
rangetop: The type is DECIMAL, Which does not inlude Null and is Unique. Values format like: [9999, 4999, 922337203685477]

#Forigen keys:


#Database Description:
The `northwind` database is a sample database designed to demonstrate the functionality of a relational database management system (SQLite). It contains information related to a fictional company that deals with products, orders, customers, suppliers, employees, and territories. The database is structured to showcase relationships between entities, including foreign keys, and supports business operations such as order processing, inventory management, and customer segmentation.

#Tables Descriptions:

1. **Categories**:  
   Contains information about product categories, including unique identifiers, names, descriptions, and associated pictures.

2. **Customers**:  
   Stores customer details such as unique customer IDs, company names, contact information, addresses, and phone numbers.

3. **Employees**:  
   Contains employee details, including unique employee IDs, names, titles, birthdates, hire dates, addresses, and reporting relationships.

4. **EmployeeTerritories**:  
   Maps employees to territories they manage, using employee IDs and territory IDs.

5. **Order_Details**:  
   Provides detailed information about orders, including order IDs, product IDs, unit prices, quantities, and discounts.

6. **Orders**:  
   Stores order-related information such as unique order IDs, customer IDs, employee IDs, order dates, required dates, shipping details, and freight costs.

7. **Products**:  
   Contains product details, including unique product IDs, names, supplier IDs, category IDs, quantity per unit, unit prices, stock levels, and reorder levels.

8. **Region**:  
   Stores region information, including unique region IDs and descriptions.

9. **Shippers**:  
   Contains details about shipping companies, including unique shipper IDs, company names, and phone numbers.

10. **Suppliers**:  
    Stores supplier information, including unique supplier IDs, company names, contact details, addresses, and homepage links.

11. **Territories**:  
    Contains territory information, including unique territory IDs, descriptions, and associated region IDs.

12. **USStates**:  
    Stores information about U.S. states, including unique state IDs, names, abbreviations, and regions.

13. **CustomerGroupThreshold**:  
    Defines customer groups based on thresholds, including group names, range bottoms, and range tops.

#Foreign Keys:
- `Products.categoryid` → `Categories.categoryid`
- `Products.supplierid` → `Suppliers.supplierid`
- `Orders.customerid` → `Customers.customerid`
- `Orders.employeeid` → `Employees.employeeid`
- `Order_Details.orderid` → `Orders.orderid`
- `Order_Details.productid` → `Products.productid`
- `EmployeeTerritories.employeeid` → `Employees.employeeid`
- `EmployeeTerritories.territoryid` → `Territories.territoryid`
- `Territories.regionid` → `Region.regionid`


Attention:
1. if the question have when\where\which, pay attention to pick table.column related to time, location and name in #columns
2. Please answer the question in the following format without any other content:
```
#reason: Analysis of which columns and values might be relevant to the question. Note that when dealing with questions about time, who, which, what, etc., you should keep column related to time, names, and locations in the #column.(format: The question query xxx, the related column include table.column, the values include values)
#columns: The top 10 columns relevant to the question( format: table.column_1, table.column_2 ...)
#values: Potential filter values that the question might query(format: "value1", "value2" ...)
```
/* Answer the following: Among employees who have more than 50 total orders, which three have the highest percentage of late orders, where an order is considered late if the shipped date is on or after its required date? Please list each employee's ID, the number of late orders, and the corresponding late-order percentage. */


############################## AI at step extract_col_value ##############################

```
#reason: The question queries employees with more than 50 total orders and focuses on late orders where shippeddate >= requireddate. Relevant columns include employee details, order dates, and shipment dates.
#columns: employees.employeeid, orders.employeeid, orders.orderid, orders.requireddate, orders.shippeddate
#values: "50"
```

############################## Human at step extract_query_noun ##############################

Please extract all nouns and phrases from the following sentence, separating the results directly with a comma( format: "noun_1", "noun_2","phrases" ):
Among employees who have more than 50 total orders, which three have the highest percentage of late orders, where an order is considered late if the shipped date is on or after its required date? Please list each employee's ID, the number of late orders, and the corresponding late-order percentage.

############################## AI at step extract_query_noun ##############################

"employees", "orders", "percentage", "late orders", "order", "shipped date", "required date", "employee's ID", "number of late orders", "late-order percentage"

############################## Human at step column_retrieve_and_other_info ##############################

现在我们定义一个问句的语法原子单元如下:
Q: 询问词: 如 calculate\ Include\ List\ List out\ List all\ give\ state\ Name\ In which\ How many\  which\ what\ who\ when\ provide\ Tally\ identify\ Find\ mention\ write等
J: 判断词： 如 Do\ Did\ If\ Is\ Are等
I: 查询内容: 查询的主体内容, 如: name, ID, date, location, item, biggest city.
C: 条件句: 通过介词和连词引入的查询的要求或属性, 如大于、等于、排序、聚合等. 介词和连词有: of\ have\ with\ that\ by. 条件句的形式例子有: with condition\ have condition\ of attribute\ that was condition


一个问题通过这些原子串联起来。常见的串联方式有
QIC(询问句): List the student with score more than 80: Q: 'List' I: 'the student' C: 'with score more than 80'
JC(判断句): State if Tom is a Cat? : J: 'State if C: is a Cat?'
C(条件句): For all people in Beijing
现在请你针对下面的问题, 把问题中的内容按照上述原子定义提取出来
问题如下: Among employees who have more than 50 total orders, which three have the highest percentage of late orders, where an order is considered late if the shipped date is on or after its required date? Please list each employee's ID, the number of late orders, and the corresponding late-order percentage.

请按照下面的json格式进行回答:

```json
[{"Type":"类型(QIC,JC,C)",
"Extract":{//不存在的填null
    "Q":"询问词",
    "J":"判断词",
    "I":['查询内容a', '查询内容b'],//只有查询内容用and或alongside连接时,才分成多个实体填入List
    "C":["条件句a","属性b"]
}},
{}]
```

############################## AI at step column_retrieve_and_other_info ##############################

```json
[
  {
    "Type": "QIC",
    "Extract": {
      "Q": "List",
      "J": null,
      "I": ["each employee's ID", "the number of late orders", "the corresponding late-order percentage"],
      "C": [
        "Among employees who have more than 50 total orders",
        "which three have the highest percentage of late orders",
        "where an order is considered late if the shipped date is on or after its required date"
      ]
    }
  }
]
```

